import{d as w,a as k,v as y,g as E,_ as b,c as g,b as o,t as $,o as u,C as j,D as B,$ as P,r as m,E as U,x as c,w as C,e as M,G as T,q as I,y as R,A as W}from"./index-bpNO_8uP.js";import{S as q,a as A}from"./SectionHeader-C4vtWxD-.js";import{S as r}from"./sweetalert2.esm.all-DzlfzZPw.js";import{C as V}from"./CardPhotoUploader-D4nm50iS.js";const H=w({emits:["edit","refresh"],props:["marketing"],data(){return{timerInterval:0}},methods:{async deleteMarketing(){await E().then(async t=>{var e;(t==null?void 0:t.role)==1?r.fire({title:"Confirmation",text:"Delete "+((e=this.marketing)==null?void 0:e.title)+"?",icon:"question",showCancelButton:!0,confirmButtonText:"Delete"}).then(async n=>{var i;n.isConfirmed&&await k.get(y().api_main+"marketing/delete?dataid="+((i=this.marketing)==null?void 0:i.dataid)).then(async l=>{var d,a,s;(d=l.data)!=null&&d.success?r.fire({title:"Success",text:(a=l.data)==null?void 0:a.message,icon:"success"}).then(async()=>{this.$emit("refresh")}):r.fire({title:"Warning",text:(s=l.data)==null?void 0:s.message,icon:"warning"})})}):r.fire({title:"Action denied",text:"Only administrator level has permission to delete",icon:"error"})})},editModal(t){this.$emit("edit",{data:t})},async sendEmailMarketing(t){r.fire({title:"Confirmation",text:"Send as email marketing?",showCancelButton:!0,confirmButtonText:"Send",icon:"question"}).then(async e=>{e.isConfirmed&&r.fire({title:"Sending...",html:"Please wait while sending email to all customers",timer:12e3,timerProgressBar:!0,didOpen:async()=>{r.showLoading(),await k.get(y().api_main+"marketing/sendMarketing?dataid="+t).then(async n=>{r.close()})},willClose:()=>{clearInterval(this.timerInterval)}}).then(n=>{r.fire({title:"Email sent",icon:"success"})})})}}}),L={class:"card my-4"},O={key:0},G=["src"],N={key:1},z=["src"],K={class:"card-body"},J={class:"text-primary"},Q={class:"p-0 m-0"},X={class:"marketing-description mt-4"},Y={class:"d-flex justify-content-end align-items-center"};function Z(t,e,n,i,l,d){var a,s,f,h,p,v,_,S;return u(),g("div",L,[((a=t.marketing)==null?void 0:a.photo).includes("mp4")?(u(),g("div",O,[o("video",{class:"marketing-cover-photo w-100 bg-dark",src:(s=t.marketing)!=null&&s.photo?(f=t.marketing)==null?void 0:f.fullpath:"",controls:""},null,8,G)])):(u(),g("div",N,[o("img",{class:"marketing-cover-photo w-100 bg-dark",src:(h=t.marketing)!=null&&h.photo?(p=t.marketing)==null?void 0:p.fullpath:"https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcRK9aVGeIwDc_9na_hcvbjcH4oqbm-nWiMs-g&s"},null,8,z)])),o("div",K,[o("h3",J,$((v=t.marketing)==null?void 0:v.title),1),o("div",null,[e[3]||(e[3]=o("h6",{class:"p-0 m-0 fw-bold"},"Date Posted:",-1)),o("p",Q,[o("small",null,$((_=t.marketing)==null?void 0:_.created_at),1)])]),o("p",X,$((S=t.marketing)==null?void 0:S.content),1),o("div",Y,[o("button",{class:"btn btn-primary w-50 me-3",onClick:e[0]||(e[0]=F=>t.editModal(t.marketing))},"Edit"),o("button",{class:"btn btn-danger w-50",onClick:e[1]||(e[1]=F=>t.deleteMarketing())},"Delete")]),o("button",{class:"btn btn-success w-100 mt-3",onClick:e[2]||(e[2]=F=>{var D;return t.sendEmailMarketing((D=t.marketing)==null?void 0:D.dataid)})},"Send Email Marketing")])])}const x=b(H,[["render",Z],["__scopeId","data-v-7c4a9b94"]]),tt=w({emits:["uploaded","fail"],props:{btn_upload_text:{default:"Upload",type:String},instruction:{default:"Upload photo with png, jpg, jpeg file extensions.",type:String}},components:{},data(){return{loading:!1,video:{coverPicked:""}}},methods:{async openPhotoChooser(){this.$refs.file.click()},async loadImage(t){var e=t.target;if(e.files&&e.files[0]){var n=new FileReader;n.onload=l=>{var d;this.video.coverPicked=(d=l==null?void 0:l.target)==null?void 0:d.result},n.readAsDataURL(e.files[0]);const i=new FormData;i.append("image",e.files[0]),this.loading=!0,await k.post(y().api_main+"photo/uploadFunct",i,{headers:{"Content-Type":"multipart/form-data"}}).then(async l=>{var d,a;this.loading=!1,(d=l.data)!=null&&d.success?this.$emit("uploaded",{data:(a=l.data)==null?void 0:a.data}):this.$emit("fail")})}}}}),et={class:"card"},ot=["src"],nt={class:"card-body"},at={class:"text-center"},it={class:"w-100"},st=["disabled"];function lt(t,e,n,i,l,d){return u(),g("div",et,[o("video",{src:t.video.coverPicked,controls:""},null,8,ot),o("div",nt,[o("p",at,$(t.instruction),1),o("input",{id:"file-video",class:"d-none",type:"file",ref:"file",onChange:e[0]||(e[0]=a=>t.loadImage(a)),accept:"video/*"},null,544),o("div",it,[o("button",{class:"btn btn-outline-primary py-2 w-100 d-flex justify-content-center align-items-center",type:"button","data-dismiss":"modal",onClick:e[1]||(e[1]=a=>t.openPhotoChooser()),disabled:t.loading},[e[2]||(e[2]=o("i",{class:"bi bi-camera-reels-fill me-2"},null,-1)),o("span",null,$(t.loading?"Uploading...":"Select Video to upload"),1)],8,st)])])])}const rt=b(tt,[["render",lt],["__scopeId","data-v-71f8eae9"]]),dt=w({emits:["refresh","closed"],props:{open:{default:!1,type:Boolean}},components:{CardVideoUploader:rt,CardPhotoUploader:V,Swiper:B,SwiperSlide:j},data(){return{swiper:{},form:{title:"",content:"",photo:"",status:1}}},methods:{onFileTypeChanged(t){(t==null?void 0:t.target.value)=="photo"?this.swiper.slideTo(0):(t==null?void 0:t.target.value)=="video"&&this.swiper.slideTo(1)},onSwiper(t){this.swiper=t},closeModal(){this.$emit("closed")},onUploadSuccess(t){var e;this.form.photo=(e=t==null?void 0:t.data)==null?void 0:e.filepath},onUploadFail(t){r.fire({title:"Warning",text:"Fail to upload photo, try again later.",icon:"warning"})},async saveMarketing(){await k.get(y().api_main+"marketing/create?"+P.param(this.form)).then(async t=>{var e,n,i;(e=t.data)!=null&&e.success?r.fire({title:"Success",text:(n=t.data)==null?void 0:n.message,icon:"success"}).then(async()=>{this.form.title="",this.form.content="",this.form.photo="",this.form.status=1,this.$emit("refresh")}):r.fire({title:"Warning",text:(i=t.data)==null?void 0:i.message,icon:"warning"})})}}}),pt={class:"modal-dialog",role:"document"},mt={class:"modal-content"},ct={class:"modal-body",style:{"max-height":"calc(100vh - 300px)",overflow:"auto"}},gt={class:"form-group mt-3"},ut={class:"form-group mt-3"},ft={class:"form-group mt-4"},ht={class:"modal-footer"};function kt(t,e,n,i,l,d){const a=c("CardPhotoUploader"),s=c("swiper-slide"),f=c("CardVideoUploader"),h=c("swiper");return u(),g("div",{class:T(["modal fade",{show:t.open,display:t.open}]),tabindex:"-1",role:"dialog"},[o("div",pt,[o("div",mt,[e[9]||(e[9]=o("div",{class:"modal-header"},[o("h5",{class:"modal-title"},"Marketing Details")],-1)),o("div",ct,[m(h,{"slides-per-view":1,"space-between":50,onSwiper:t.onSwiper},{default:U(()=>[m(s,{class:"swiper-no-swiping"},{default:U(()=>[m(a,{onUploaded:t.onUploadSuccess,onFail:t.onUploadFail,instruction:"Upload photo with png, jpg, jpeg file extension"},null,8,["onUploaded","onFail"])]),_:1}),m(s,{class:"swiper-no-swiping"},{default:U(()=>[m(f,{onUploaded:t.onUploadSuccess,onFail:t.onUploadFail,instruction:"Upload video with mp4 extension"},null,8,["onUploaded","onFail"])]),_:1})]),_:1},8,["onSwiper"]),o("div",gt,[e[6]||(e[6]=o("label",null,"File Type",-1)),o("select",{class:"form-control form-control-lg",onChange:e[0]||(e[0]=(...p)=>t.onFileTypeChanged&&t.onFileTypeChanged(...p))},[...e[5]||(e[5]=[o("option",{value:"0"},"Select File Type",-1),o("option",{value:"photo"},"Photo",-1),o("option",{value:"video"},"Video",-1)])],32)]),o("div",ut,[e[7]||(e[7]=o("label",null,"Title",-1)),C(o("input",{"onUpdate:modelValue":e[1]||(e[1]=p=>t.form.title=p),type:"text",class:"form-control form-control-lg"},null,512),[[M,t.form.title]])]),o("div",ft,[e[8]||(e[8]=o("label",null,"Description",-1)),C(o("textarea",{"onUpdate:modelValue":e[2]||(e[2]=p=>t.form.content=p),class:"form-control form-control-lg"},null,512),[[M,t.form.content]])])]),o("div",ht,[o("button",{type:"button",class:"btn btn-secondary","data-dismiss":"modal",onClick:e[3]||(e[3]=p=>t.closeModal())},"Close"),o("button",{type:"button",class:"btn btn-primary",onClick:e[4]||(e[4]=p=>t.saveMarketing())},"Save")])])])],2)}const yt=b(dt,[["render",kt],["__scopeId","data-v-f8f63a88"]]),vt=w({props:{open:{default:!1,type:Boolean},marketing:{default:{},type:Object}},components:{CardPhotoUploader:V},data(){return{}},methods:{closeModal(){this.$emit("closed")},async saveMarketing(){await k.get(y().api_main+"marketing/update?"+P.param(this.marketing)).then(async t=>{var e,n,i;(e=t.data)!=null&&e.success?r.fire({title:"Success",text:(n=t.data)==null?void 0:n.message,icon:"success"}).then(async()=>{this.$emit("refresh")}):r.fire({title:"Warning",text:(i=t.data)==null?void 0:i.message,icon:"warning"})})},onUploadSuccess(t){var e;this.marketing.photo=(e=t==null?void 0:t.data)==null?void 0:e.filepath},onUploadFail(t){r.fire({title:"Warning",text:"Fail to replace photo, try again later.",icon:"warning"})}}}),$t={class:"modal-dialog",role:"document"},wt={class:"modal-content"},bt={class:"modal-body",style:{"max-height":"calc(100vh - 300px)",overflow:"auto"}},_t={class:"form-group mt-3"},Ct={class:"form-group mt-4"},Mt={class:"modal-footer"};function St(t,e,n,i,l,d){const a=c("CardPhotoUploader");return u(),g("div",{class:T(["modal fade",{show:t.open,display:t.open}]),tabindex:"-1",role:"dialog"},[o("div",$t,[o("div",wt,[e[6]||(e[6]=o("div",{class:"modal-header"},[o("h5",{class:"modal-title"},"Update Marketing")],-1)),e[7]||(e[7]=o("hr",null,null,-1)),o("div",bt,[m(a,{onUploaded:t.onUploadSuccess,onFail:t.onUploadFail,btn_upload_text:"Replace",instruction:"Select photo with png, jpg, jpeg file extensions for marketing photo replacement."},null,8,["onUploaded","onFail"]),o("div",_t,[e[4]||(e[4]=o("label",null,"Title",-1)),C(o("input",{"onUpdate:modelValue":e[0]||(e[0]=s=>t.marketing.title=s),type:"text",class:"form-control form-control-lg"},null,512),[[M,t.marketing.title]])]),o("div",Ct,[e[5]||(e[5]=o("label",null,"Description",-1)),C(o("textarea",{"onUpdate:modelValue":e[1]||(e[1]=s=>t.marketing.content=s),class:"form-control form-control-lg",style:{"min-height":"250px"}},null,512),[[M,t.marketing.content]])])]),o("div",Mt,[o("button",{type:"button",class:"btn btn-secondary","data-dismiss":"modal",onClick:e[2]||(e[2]=s=>t.closeModal())},"Close"),o("button",{type:"button",class:"btn btn-primary",onClick:e[3]||(e[3]=s=>t.saveMarketing())},"Save")])])])],2)}const Ut=b(vt,[["render",St],["__scopeId","data-v-d6b4742e"]]),Ft=w({components:{ModalEditMarketing:Ut,ModalCreateMarketing:yt,CardMarketing:x,SectionSidebar:A,SectionHeader:q},data(){return{admin:{},modal:{create_marketing_open:!1,update_marketing_open:!1,update_marketing_info:{}},marketings:{}}},methods:{async fetchMarketing(){await k.get(y().api_main+"marketing/fetchAll").then(async t=>{this.marketings=t.data})},openEditModal(t){this.modal.update_marketing_open=!0,this.modal.update_marketing_info=t.data}},async mounted(){await E().then(async t=>{t?(this.admin=t,await this.fetchMarketing().then(async()=>{console.log("Marketing:",I(this.$data))})):this.$router.replace("/")})}}),Dt={class:"layout-wrapper layout-content-navbar"},Et={class:"layout-container"},Pt={class:"layout-page"},Tt={class:"content-wrapper"},Vt={class:"container-xxl flex-grow-1 container-p-y"},jt={class:"d-flex justify-content-between align-items-center py-3"},Bt={class:"d-flex"},It={class:"row"};function Rt(t,e,n,i,l,d){const a=c("SectionSidebar"),s=c("SectionHeader"),f=c("CardMarketing"),h=c("ModalCreateMarketing"),p=c("ModalEditMarketing");return u(),g("div",Dt,[o("div",Et,[m(a),o("div",Pt,[m(s,{onOpen_notif:e[0]||(e[0]=()=>{t.$emit("open_notif")})}),o("div",Tt,[o("div",Vt,[o("div",jt,[e[7]||(e[7]=o("h4",{class:"fw-bold"},"Manage Marketing",-1)),o("div",Bt,[e[6]||(e[6]=o("input",{type:"text",class:"form-control me-3",placeholder:"Search"},null,-1)),o("button",{class:"btn btn-primary",style:{width:"180px"},onClick:e[1]||(e[1]=()=>{t.modal.create_marketing_open=!0})},"Create")])]),o("div",It,[(u(!0),g(R,null,W(t.marketings,(v,_)=>(u(),g("div",{class:"col-sm-12 col-md-6 col-lg-4",key:_},[m(f,{marketing:v,onEdit:t.openEditModal,onRefresh:e[2]||(e[2]=S=>t.fetchMarketing())},null,8,["marketing","onEdit"])]))),128))])])])])]),m(h,{open:t.modal.create_marketing_open,onClosed:e[3]||(e[3]=()=>{t.modal.create_marketing_open=!1}),onRefresh:e[4]||(e[4]=v=>t.fetchMarketing())},null,8,["open"]),m(p,{open:t.modal.update_marketing_open,marketing:t.modal.update_marketing_info,onClosed:e[5]||(e[5]=()=>{t.modal.update_marketing_open=!1})},null,8,["open","marketing"])])}const Lt=b(Ft,[["render",Rt]]);export{Lt as default};
