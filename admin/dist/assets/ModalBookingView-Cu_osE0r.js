import{d as et,g as nt,q as ot,a as w,v as C,$ as X,M as st,_ as it,c as h,b as t,w as _,t as s,O as lt,y as Y,A as Z,e as tt,G as at,o as v}from"./index-bpNO_8uP.js";import{t as dt}from"./formatter-Cd5PYes5.js";import{S as l}from"./sweetalert2.esm.all-DzlfzZPw.js";const rt=et({emits:["closed","refresh"],props:{open:{default:!1,type:Boolean},booking:{default:{},type:Object}},data(){return{user:{},add_fee_amount:0,add_fee_description:""}},methods:{closeModal(){this.$emit("closed")},toCurrencyFormat(n){return dt(n)},async addFees(){var n,e;this.add_fee_amount==0?l.fire({title:"Required!",text:"Amount is required",icon:"warning"}):this.add_fee_description==""?l.fire({title:"Required!",text:"Description is required",icon:"warning"}):await st({connection:"undercater",table:"booking",where:[["dataid",(e=(n=this.booking)==null?void 0:n.header)==null?void 0:e.dataid]],columns:[{add_fee_amount:this.add_fee_amount},{add_fee_description:this.add_fee_description}]}).then(async i=>{i!=null&&i.success?l.fire({title:"Success",icon:"success"}):l.fire({title:"Warning",text:"Something went wrong, try again later."})})},async sendContract(){var n,e;l.fire({title:"Confirmation",text:"Send contract to "+((e=(n=this.booking)==null?void 0:n.header)==null?void 0:e.first_name)+"?",showCancelButton:!0,confirmButtonText:"Send",icon:"question"}).then(async i=>{var m,a;i.isConfirmed&&await w.get(C().api_main+"booking/sendContract?booking_dataid="+((a=(m=this.booking)==null?void 0:m.header)==null?void 0:a.dataid)).then(async b=>{var d,r,u;(d=b.data)!=null&&d.success?l.fire({title:"Success",text:(r=b.data)==null?void 0:r.message,icon:"success"}):l.fire({title:"Fail",text:(u=b.data)==null?void 0:u.message,icon:"warning"})})})},async bookingApprove(){var n,e;l.fire({title:"Confirmation",text:"Approve booking of "+((e=(n=this.booking)==null?void 0:n.header)==null?void 0:e.first_name)+"?",showCancelButton:!0,confirmButtonText:"Approve",icon:"question"}).then(async i=>{var a,b,d,r,u,f;if(i.isConfirmed){var m={booking_dataid:(b=(a=this.booking)==null?void 0:a.header)==null?void 0:b.dataid,email:(r=(d=this.booking)==null?void 0:d.header)==null?void 0:r.email,book_event:(f=(u=this.booking)==null?void 0:u.event)==null?void 0:f.name};await w.get(C().api_main+"booking/approve?"+X.param(m)).then(async g=>{var p,y,k;(p=g.data)!=null&&p.success?l.fire({title:"Approved",text:(y=g.data)==null?void 0:y.message,icon:"success"}).then(async()=>{this.$emit("refresh")}):l.fire({title:"Warning",text:(k=g.data)==null?void 0:k.message,icon:"warning"})})}})},async bookingDecline(){var n,e;l.fire({title:"Confirmation",text:"Decline booking of "+((e=(n=this.booking)==null?void 0:n.header)==null?void 0:e.first_name)+"?",showCancelButton:!0,confirmButtonText:"Decline",icon:"question"}).then(async i=>{var a,b,d,r,u,f;if(i.isConfirmed){var m={booking_dataid:(b=(a=this.booking)==null?void 0:a.header)==null?void 0:b.dataid,email:(r=(d=this.booking)==null?void 0:d.header)==null?void 0:r.email,book_event:(f=(u=this.booking)==null?void 0:u.event)==null?void 0:f.name};await w.get(C().api_main+"booking/decline?"+X.param(m)).then(async g=>{var p,y,k;(p=g.data)!=null&&p.success?l.fire({title:"Decline",text:(y=g.data)==null?void 0:y.message,icon:"success"}).then(async()=>{this.$emit("refresh")}):l.fire({title:"Warning",text:(k=g.data)==null?void 0:k.message,icon:"warning"})})}})}},watch:{open:async function(){await nt().then(async n=>{var e,i,m,a;this.user=n,this.add_fee_amount=(i=(e=this.booking)==null?void 0:e.header)==null?void 0:i.add_fee_amount,this.add_fee_description=(a=(m=this.booking)==null?void 0:m.header)==null?void 0:a.add_fee_description,console.log("Booking View:",ot(this.$data))})}}}),ut={class:"modal-dialog",role:"document"},mt={class:"modal-content"},bt={class:"modal-body bg-light-gray",style:{"max-height":"calc(100vh - 300px)",overflow:"auto"}},gt={class:"card"},ft={class:"card-body"},pt={class:"table-borderless"},yt={class:"d-flex justify-content-end mt-4"},kt={class:"card"},ht={class:"card-body"},vt={class:"table"},ct={class:"card"},wt={class:"card-body"},Ct={class:"table"},_t={class:"d-flex justify-content-start"},Bt={class:"card"},Dt=["src"],$t={class:"card-body"},At={class:"card"},St={class:"card-body"},Ft={class:"table-borderless"},qt=["src"],Nt={class:"card"},Mt={class:"card-body"},Tt={class:"mb-3"},Rt={class:"mb-3"},Vt={class:"d-flex justify-content-end"},jt={class:"modal-footer"};function Et(n,e,i,m,a,b){var d,r,u,f,g,p,y,k,B,D,$,A,S,F,q,N,M,T,R,V,j,E,L,U,x,I,O,W,G,P,z,H,J,K,Q;return v(),h("div",{class:at(["modal fade",{show:n.open,display:n.open}]),tabindex:"-1",role:"dialog"},[t("div",ut,[t("div",mt,[e[34]||(e[34]=t("div",{class:"modal-header"},[t("h5",{class:"modal-title"},"Booking Details")],-1)),t("div",bt,[e[28]||(e[28]=t("h5",null,"Event Details",-1)),t("div",gt,[t("div",ft,[t("table",pt,[t("tbody",null,[t("tr",null,[e[7]||(e[7]=t("td",{style:{width:"180px"}},"Event",-1)),t("td",null,s((r=(d=n.booking)==null?void 0:d.event)==null?void 0:r.name),1)]),t("tr",null,[e[8]||(e[8]=t("td",{style:{width:"180px"}},"Location Type",-1)),t("td",null,s((f=(u=n.booking)==null?void 0:u.location)==null?void 0:f.key),1)]),t("tr",null,[e[9]||(e[9]=t("td",{style:{width:"180px"}},"Date",-1)),t("td",null,s((p=(g=n.booking)==null?void 0:g.header)==null?void 0:p.event_date),1)]),t("tr",null,[e[10]||(e[10]=t("td",{style:{width:"180px"}},"Check In",-1)),t("td",null,s((k=(y=n.booking)==null?void 0:y.header)==null?void 0:k.event_start_time),1)]),t("tr",null,[e[11]||(e[11]=t("td",{style:{width:"180px"}},"Check Out",-1)),t("td",null,s((D=(B=n.booking)==null?void 0:B.header)==null?void 0:D.event_end_time),1)]),t("tr",null,[e[12]||(e[12]=t("td",{style:{width:"180px"}},"Grand Total",-1)),t("td",null,s(n.toCurrencyFormat((A=($=n.booking)==null?void 0:$.header)==null?void 0:A.total_price)),1)]),t("tr",null,[e[13]||(e[13]=t("td",{style:{width:"180px"}},"Status",-1)),t("td",null,s((F=(S=n.booking)==null?void 0:S.status)==null?void 0:F.value),1)])])]),_(t("div",null,[t("div",yt,[t("button",{class:"btn btn-danger w-25 me-4",onClick:e[0]||(e[0]=o=>n.bookingDecline())},"Decline"),t("button",{class:"btn btn-primary w-50 me-4",onClick:e[1]||(e[1]=o=>n.sendContract())},"Send Contract"),t("button",{class:"btn btn-primary w-25",onClick:e[2]||(e[2]=o=>n.bookingApprove())},"Approve")])],512),[[lt,((q=n.user)==null?void 0:q.role)==1]])])]),e[29]||(e[29]=t("h5",{class:"mt-4"},"Food",-1)),t("div",kt,[t("div",ht,[t("table",vt,[e[14]||(e[14]=t("thead",null,[t("tr",null,[t("th",null,"No"),t("th",null,"Name"),t("th",null,"Category")])],-1)),t("tbody",null,[(v(!0),h(Y,null,Z((N=n.booking)==null?void 0:N.food,(o,c)=>(v(),h("tr",null,[t("td",null,s(c+1),1),t("td",null,s(o==null?void 0:o.name),1),t("td",null,s(o==null?void 0:o.category),1)]))),256))])])])]),e[30]||(e[30]=t("h5",{class:"mt-4"},"Add-ons",-1)),t("div",ct,[t("div",wt,[t("table",Ct,[e[15]||(e[15]=t("thead",null,[t("tr",null,[t("th",null,"No"),t("th",null,"Name"),t("th",null,"Price")])],-1)),t("tbody",null,[(v(!0),h(Y,null,Z((M=n.booking)==null?void 0:M.addons,(o,c)=>(v(),h("tr",{key:c},[t("td",null,s(c+1),1),t("td",null,s(o==null?void 0:o.name),1),t("td",null,s(n.toCurrencyFormat(o==null?void 0:o.booking_addons_price)),1)]))),128))])]),t("div",_t,[t("p",null,"Total: "+s(n.toCurrencyFormat((T=n.booking)==null?void 0:T.addons_total)),1)])])]),e[31]||(e[31]=t("h5",{class:"mt-4"},"Payment Receipt",-1)),t("div",Bt,[t("img",{class:"w-100",src:"https://api-fileserver.jlipreso.com/"+((V=(R=n.booking)==null?void 0:R.header)==null?void 0:V.payment_receipt)},null,8,Dt),t("div",$t,[e[20]||(e[20]=t("p",null,"Receipt uploaded as payment reference",-1)),t("table",null,[t("tbody",null,[t("tr",null,[e[16]||(e[16]=t("td",null,"Reference No.",-1)),e[17]||(e[17]=t("td",{class:"px-3"},":",-1)),t("td",null,s((E=(j=n.booking)==null?void 0:j.header)==null?void 0:E.payment_refid),1)]),t("tr",null,[e[18]||(e[18]=t("td",null,"Sender Name",-1)),e[19]||(e[19]=t("td",{class:"px-3"},":",-1)),t("td",null,s((U=(L=n.booking)==null?void 0:L.header)==null?void 0:U.payment_sender),1)])])])])]),e[32]||(e[32]=t("h5",{class:"mt-4"},"Customer Details",-1)),t("div",At,[t("div",St,[t("table",Ft,[t("tbody",null,[t("tr",null,[e[21]||(e[21]=t("td",{style:{width:"180px"}},"Customer Name",-1)),t("td",null,": "+s(((I=(x=n.booking)==null?void 0:x.header)==null?void 0:I.first_name)+" "+((W=(O=n.booking)==null?void 0:O.header)==null?void 0:W.last_name)),1)]),t("tr",null,[e[22]||(e[22]=t("td",null,"Email",-1)),t("td",null,": "+s((P=(G=n.booking)==null?void 0:G.header)==null?void 0:P.email),1)]),t("tr",null,[e[23]||(e[23]=t("td",null,"Mobile",-1)),t("td",null,": "+s((H=(z=n.booking)==null?void 0:z.header)==null?void 0:H.phone),1)]),t("tr",null,[e[24]||(e[24]=t("td",null,"Location",-1)),t("td",null,": "+s((K=(J=n.booking)==null?void 0:J.location)==null?void 0:K.key),1)]),e[25]||(e[25]=t("tr",null,[t("td",null,"Valid ID"),t("td",null,":")],-1))])]),t("img",{class:"w-100 mt-3",src:(Q=n.booking)==null?void 0:Q.valid_id},null,8,qt)])]),e[33]||(e[33]=t("h5",{class:"mt-4"},"Additional Fees",-1)),t("div",Nt,[t("div",Mt,[t("div",Tt,[e[26]||(e[26]=t("label",{class:"form-label"},"Amount",-1)),_(t("input",{"onUpdate:modelValue":e[3]||(e[3]=o=>n.add_fee_amount=o),type:"number",class:"form-control"},null,512),[[tt,n.add_fee_amount]])]),t("div",Rt,[e[27]||(e[27]=t("label",{class:"form-label"},"Fee descriptions",-1)),_(t("textarea",{"onUpdate:modelValue":e[4]||(e[4]=o=>n.add_fee_description=o),class:"form-control",rows:"3"},null,512),[[tt,n.add_fee_description]])]),t("div",Vt,[t("button",{class:"btn btn-primary w-50",onClick:e[5]||(e[5]=o=>n.addFees())},"Add to Billing")])])])]),t("div",jt,[t("button",{type:"button",class:"btn btn-secondary","data-dismiss":"modal",onClick:e[6]||(e[6]=o=>n.closeModal())},"Close")])])])],2)}const It=it(rt,[["render",Et],["__scopeId","data-v-4d6512ee"]]);export{It as M};
