import{c as m,_ as L,e as ye,S as ce,b as he,d as fe}from"./SectionFooter-p82ZZrBf.js";import{t as T,C as be,_ as ge}from"./gcashho-CTLYNKCr.js";import{a as W,v as j}from"./index-voVhswPz.js";import{$ as ue}from"./jquery-DvzhgAK6.js";import{d as I,i as V,c as y,a as e,g as D,h as de,t as o,F as E,j as A,n as me,o as c,f as b,w as R,r as w,b as re,v as pe}from"./index-cvgqalPm.js";import{S as ve,a as we}from"./swiper-vue-CjEnmZyX.js";const ke=I({emits:["closed","refresh"],props:{open:{default:!1,type:Boolean},booking:{default:{},type:Object}},data(){return{}},methods:{closeModal(){this.$emit("closed")},toCurrencyFormat(s){return T(s)},async onCancelBooking(){var s,t;m.fire({title:"Confirmation",text:"Cancel booking for "+((t=(s=this.booking)==null?void 0:s.event)==null?void 0:t.name)+"?",icon:"question",showCancelButton:!0,confirmButtonText:"Yes"}).then(async g=>{var h,f,i,d,r,l;if(g.isConfirmed){var v={booking_dataid:(f=(h=this.booking)==null?void 0:h.header)==null?void 0:f.dataid,email:(d=(i=this.booking)==null?void 0:i.header)==null?void 0:d.email,book_event:(l=(r=this.booking)==null?void 0:r.event)==null?void 0:l.name};await W.get(j().api_main+"booking/cancel?"+ue.param(v)).then(async p=>{var n,u;(n=p.data)!=null&&n.success?m.fire({title:"Success",text:"",icon:"success"}).then(async()=>{this.$emit("refresh")}):m.fire({title:"Warning",text:(u=p.data)==null?void 0:u.message,icon:"warning"})})}})}},watch:{open:function(){this.open&&console.log(V(this.booking))}}}),$e={class:"modal-dialog",role:"document"},Ce={class:"modal-content"},_e={class:"modal-body bg-light-gray",style:{"max-height":"calc(100vh - 300px)",overflow:"auto"}},Se={class:"alert alert-danger"},Fe={class:"card"},Pe={class:"card-body"},Be={class:"table-borderless"},Me=["title"],Ne={class:"card"},Ue={class:"card-body"},Te={class:"table"},De={class:"card"},Re={class:"card-body"},Ee={class:"table"},Ae={class:"d-flex justify-content-start"},Le={class:"card"},We={class:"card-body"},je={class:"table-borderless"},Ie=["src"],Ve={class:"modal-footer"};function qe(s,t,g,v,h,f){var i,d,r,l,p,n,u,k,$,C,_,S,F,P,B,M,N,q,G,H,x,O,Y,z,Q,J,K,X,Z,ee,te,se,ne,oe,le,ae,ie;return c(),y("div",{class:me(["modal fade",{show:s.open,display:s.open}]),tabindex:"-1",role:"dialog"},[e("div",$e,[e("div",Ce,[t[22]||(t[22]=e("div",{class:"modal-header"},[e("h5",{class:"modal-title"},"Booking Details")],-1)),e("div",_e,[D(e("div",Se,[...t[2]||(t[2]=[e("p",{class:"text-center fs-3 p-0 m-0"},[e("strong",null,"CANCELLED")],-1),e("p",{class:"text-center p-0 m-0"},"This booking has been cancelled by customer",-1)])],512),[[de,((d=(i=s.booking)==null?void 0:i.status)==null?void 0:d.key)==4]]),t[18]||(t[18]=e("h5",null,"Event Details",-1)),e("div",Fe,[e("div",Pe,[e("table",Be,[e("tbody",null,[e("tr",null,[t[3]||(t[3]=e("td",{style:{width:"180px"}},"Event",-1)),e("td",null,o((l=(r=s.booking)==null?void 0:r.event)==null?void 0:l.name),1)]),e("tr",null,[t[4]||(t[4]=e("td",{style:{width:"180px"}},"Location Type",-1)),e("td",null,o((n=(p=s.booking)==null?void 0:p.location)==null?void 0:n.key),1)]),e("tr",null,[t[5]||(t[5]=e("td",{style:{width:"180px"}},"Date",-1)),e("td",null,o((k=(u=s.booking)==null?void 0:u.header)==null?void 0:k.event_date),1)]),e("tr",null,[t[6]||(t[6]=e("td",{style:{width:"180px"}},"Check In",-1)),e("td",null,o((C=($=s.booking)==null?void 0:$.header)==null?void 0:C.event_start_time),1)]),e("tr",null,[t[7]||(t[7]=e("td",{style:{width:"180px"}},"Check Out",-1)),e("td",null,o((S=(_=s.booking)==null?void 0:_.header)==null?void 0:S.event_end_time),1)]),e("tr",{title:(F=s.booking)==null?void 0:F.header.add_fee_description},[t[8]||(t[8]=e("td",{style:{width:"180px"}},"Added Fees",-1)),e("td",null,o(s.toCurrencyFormat((B=(P=s.booking)==null?void 0:P.header)==null?void 0:B.add_fee_amount)),1)],8,Me),e("tr",null,[t[9]||(t[9]=e("td",{style:{width:"180px"}},"Grand Total",-1)),e("td",null,o(s.toCurrencyFormat(parseFloat((N=(M=s.booking)==null?void 0:M.header)==null?void 0:N.total_price)+parseFloat((G=(q=s.booking)==null?void 0:q.header)==null?void 0:G.add_fee_amount))),1)]),e("tr",null,[t[10]||(t[10]=e("td",{style:{width:"180px"}},"Status",-1)),e("td",null,o((x=(H=s.booking)==null?void 0:H.status)==null?void 0:x.value),1)])])])])]),t[19]||(t[19]=e("h5",{class:"mt-4"},"Food",-1)),e("div",Ne,[e("div",Ue,[e("table",Te,[t[11]||(t[11]=e("thead",null,[e("tr",null,[e("th",null,"No"),e("th",null,"Name"),e("th",null,"Category")])],-1)),e("tbody",null,[(c(!0),y(E,null,A((O=s.booking)==null?void 0:O.food,(a,U)=>(c(),y("tr",null,[e("td",null,o(U+1),1),e("td",null,o(a==null?void 0:a.name),1),e("td",null,o(a==null?void 0:a.category),1)]))),256))])])])]),t[20]||(t[20]=e("h5",{class:"mt-4"},"Add-ons",-1)),e("div",De,[e("div",Re,[e("table",Ee,[t[12]||(t[12]=e("thead",null,[e("tr",null,[e("th",null,"No"),e("th",null,"Name"),e("th",null,"Price")])],-1)),e("tbody",null,[(c(!0),y(E,null,A((Y=s.booking)==null?void 0:Y.addons,(a,U)=>(c(),y("tr",{key:U},[e("td",null,o(U+1),1),e("td",null,o(a==null?void 0:a.name),1),e("td",null,o(s.toCurrencyFormat(a==null?void 0:a.booking_addons_price)),1)]))),128))])]),e("div",Ae,[e("p",null,"Total: "+o(s.toCurrencyFormat((z=s.booking)==null?void 0:z.addons_total)),1)])])]),t[21]||(t[21]=e("h5",{class:"mt-4"},"Customer Details",-1)),e("div",Le,[e("div",We,[e("table",je,[e("tbody",null,[e("tr",null,[t[13]||(t[13]=e("td",{style:{width:"180px"}},"Customer Name",-1)),e("td",null,": "+o(((J=(Q=s.booking)==null?void 0:Q.header)==null?void 0:J.first_name)+" "+((X=(K=s.booking)==null?void 0:K.header)==null?void 0:X.last_name)),1)]),e("tr",null,[t[14]||(t[14]=e("td",null,"Email",-1)),e("td",null,": "+o((ee=(Z=s.booking)==null?void 0:Z.header)==null?void 0:ee.email),1)]),e("tr",null,[t[15]||(t[15]=e("td",null,"Mobile",-1)),e("td",null,": "+o((se=(te=s.booking)==null?void 0:te.header)==null?void 0:se.phone),1)]),e("tr",null,[t[16]||(t[16]=e("td",null,"Location",-1)),e("td",null,": "+o((oe=(ne=s.booking)==null?void 0:ne.location)==null?void 0:oe.key),1)]),t[17]||(t[17]=e("tr",null,[e("td",null,"Valid ID"),e("td",null,":")],-1))])]),e("img",{class:"w-100 mt-3",src:(le=s.booking)==null?void 0:le.valid_id},null,8,Ie)])])]),e("div",Ve,[e("button",{type:"button",class:"btn btn-secondary",onClick:t[0]||(t[0]=a=>s.closeModal())},"Close"),D(e("button",{class:"btn btn-danger",onClick:t[1]||(t[1]=a=>s.onCancelBooking())},"Cancel Booking",512),[[de,((ie=(ae=s.booking)==null?void 0:ae.status)==null?void 0:ie.key)!=4]])])])])],2)}const Ge=L(ke,[["render",qe],["__scopeId","data-v-5e352f28"]]),He=I({emits:["closed","refresh"],props:{open:{default:!1,type:Boolean},booking:{default:{},type:Object}},components:{CardPhotoUploader:be,Swiper:we,SwiperSlide:ve},data(){return{swiper:{},done:!1,pay_refid:"",pay_sender:""}},methods:{onSwiper(s){this.swiper=s},closeModal(){this.$emit("closed")},toCurrencyFormat(s){return T(s)},slideToUpload(){this.pay_refid==""?m.fire({title:"Warning",text:"Payment Reference Number is required",icon:"warning"}):this.pay_sender==""?m.fire({title:"Warning",text:"Payment Sender Name is required",icon:"warning"}):this.swiper.slideTo(1)},async onUploadSuccess(s){this.pay_refid==""?m.fire({title:"Warning",text:"Payment Reference Number is required",icon:"warning"}):this.pay_sender==""?m.fire({title:"Warning",text:"Payment Sender Name is required",icon:"warning"}):await ye().then(async()=>{var v,h,f,i,d,r,l;var t={booking_dataid:(v=this.booking)==null?void 0:v.header.dataid,photo:(h=s==null?void 0:s.data)==null?void 0:h.filepath,pay_refid:this.pay_refid,pay_sender:this.pay_sender,customer_name:((f=this.booking)==null?void 0:f.header.first_name)+" "+((i=this.booking)==null?void 0:i.header.last_name),customer_email:(d=this.booking)==null?void 0:d.header.email,event_name:(r=this.booking)==null?void 0:r.event.name,event_location:(l=this.booking)==null?void 0:l.header.event_location},g=j().api_main+"booking/updatePaymentReceipt?"+ue.param(t);console.log("Post:",g),await W.get(g).then(async p=>{var n,u;(n=p.data)!=null&&n.success?(this.done=!0,m.fire({title:"Uploaded",text:"Payment receipt uploaded successfully",icon:"info"}).then(()=>{})):m.fire({title:"Warning",text:(u=p.data)==null?void 0:u.message,icon:"warning"})})})},onUploadFail(s){m.fire({title:"Warning",text:"Fail to upload photo, try again later.",icon:"warning"})}},watch:{open:function(){console.log(V(this.booking))}}}),xe={class:"modal-dialog modal-lg",role:"document"},Oe={class:"modal-content"},Ye={class:"modal-body bg-light-gray",style:{"max-height":"calc(100vh - 300px)",overflow:"auto"}},ze={class:"card"},Qe={class:"card-body"},Je={class:"row mt-5 mb-4"},Ke={class:"col-6"},Xe={class:"col-6"},Ze={class:"d-flex justify-content-center"},et={class:"card"},tt={class:"card-body"},st={class:"modal-footer"};function nt(s,t,g,v,h,f){const i=w("swiper-slide"),d=w("CardPhotoUploader"),r=w("swiper");return c(),y("div",{class:me(["modal fade",{show:s.open,display:s.open}]),tabindex:"-1",role:"dialog"},[e("div",xe,[e("div",Oe,[t[16]||(t[16]=e("div",{class:"modal-header"},[e("h5",{class:"modal-title"},"Payment")],-1)),e("div",Ye,[b(r,{"slides-per-view":1,"space-between":50,onSwiper:s.onSwiper},{default:R(()=>[b(i,{class:"swiper-no-swiping"},{default:R(()=>[e("div",ze,[e("div",Qe,[t[6]||(t[6]=e("h3",{class:"text-center"},"GCash Payment",-1)),t[7]||(t[7]=e("p",{class:"text-center"},[e("small",null,[re("Scan the GCash QR code below and pay the total amount to complete your booking."),e("br"),re("You need to pay 50% of the total. Here is 50% of your order.")])],-1)),t[8]||(t[8]=e("img",{class:"gcash-image",src:ge},null,-1)),t[9]||(t[9]=e("p",{class:"text-center fs-4 fw-bold p-0 m-0"},"Transfer fees may apply",-1)),t[10]||(t[10]=e("p",{class:"text-center fs-2 fw-bold p-0 m-0",style:{color:"#085bde"}},"AI**E L.",-1)),t[11]||(t[11]=e("p",{class:"text-center fs-4 fw-bold p-0 m-0"},[e("span",null,"Mobile No.: "),e("span",null,"091* ****911")],-1)),t[12]||(t[12]=e("p",{class:"mb-4 text-muted text-center"},"Once payment is made, upload your receipt to confirm your booking.",-1)),e("div",Je,[e("div",Ke,[t[4]||(t[4]=e("label",{class:"form-label"},"Reference No.",-1)),D(e("input",{"onUpdate:modelValue":t[0]||(t[0]=l=>s.pay_refid=l),type:"number",class:"form-control"},null,512),[[pe,s.pay_refid]])]),e("div",Xe,[t[5]||(t[5]=e("label",{class:"form-label"},"Sender Name",-1)),D(e("input",{"onUpdate:modelValue":t[1]||(t[1]=l=>s.pay_sender=l),type:"text",class:"form-control"},null,512),[[pe,s.pay_sender]])])]),e("div",Ze,[e("button",{class:"btn btn-primary w-50",onClick:t[2]||(t[2]=l=>s.slideToUpload())},"Upload Payment Receipt")])])])]),_:1}),b(i,{class:"swiper-no-swiping"},{default:R(()=>[e("div",et,[e("div",tt,[t[13]||(t[13]=e("h3",{class:"text-center"},"GCash Payment Receipt",-1)),t[14]||(t[14]=e("p",{class:"text-center"},[e("small",null,"Please upload screenshot of your payment")],-1)),b(d,{onUploaded:s.onUploadSuccess,onFail:s.onUploadFail},null,8,["onUploaded","onFail"]),t[15]||(t[15]=e("div",{class:"d-flex justify-content-end mt-4"},[e("button",{class:"btn btn-primary w-25"},"Submit Receipt")],-1))])])]),_:1})]),_:1},8,["onSwiper"])]),e("div",st,[e("button",{type:"button",class:"btn btn-secondary",onClick:t[3]||(t[3]=l=>s.closeModal())},"Close")])])])],2)}const ot=L(He,[["render",nt],["__scopeId","data-v-03f8204a"]]),lt=I({name:"MyAccountPage",components:{ModalPayment:ot,ModalBooking:Ge,SectionFooter:he,SectionHeader:ce},data(){return{loading:!1,user:{},bookings:{},modal:{booking:{open:!1,booking:{}},payment:{open:!1,booking:{}}}}},methods:{toCurrencyFormat(s){return isNaN(s)?T(0):T(s)},openPayment(s){this.modal.payment.open=!0,this.modal.payment.booking=s},openBooking(s){this.modal.booking.open=!0,this.modal.booking.booking=s},async fetchMyBooking(){var s;await W.get(j().api_main+"booking/fetchByUser/"+((s=this.user)==null?void 0:s.dataid)).then(async t=>{this.bookings=t.data})}},async mounted(){await fe().then(async s=>{this.user=s,s?await this.fetchMyBooking().then(async()=>{console.log("My Account:",V(this.$data))}):this.$router.replace("/")})}}),at={class:"main"},it={class:"content"},dt={class:"container"},rt={class:"container",style:{"min-height":"calc(100vh - 300px)"}},pt={class:"table-responsive"},ut={class:"pt-5"},mt={class:"table mt-4 bg-dark text-white"},yt=["onClick"],ct=["onClick"];function ht(s,t,g,v,h,f){var p;const i=w("SectionHeader"),d=w("SectionFooter"),r=w("ModalBooking"),l=w("ModalPayment");return c(),y("div",null,[b(i),e("main",at,[e("div",it,[e("div",dt,[e("div",rt,[e("div",pt,[e("h1",ut,"Hi, "+o((p=s.user)==null?void 0:p.firstname),1),t[5]||(t[5]=e("h3",null,"Manage Booking",-1)),e("table",mt,[t[4]||(t[4]=e("thead",null,[e("tr",null,[e("th",{class:"py-2"},"No"),e("th",{class:"py-2"},"Event"),e("th",{class:"py-2"},"No. Pax"),e("th",{class:"py-2"},"Date"),e("th",{class:"py-2"},"Start Time"),e("th",{class:"py-2"},"End Time"),e("th",{class:"py-2"},"Added Fee"),e("th",{class:"py-2"},"Grand Total"),e("th",{class:"py-2"},"Status"),e("th",{class:"py-2",style:{width:"100px"}},"Payment"),e("th",{class:"py-2",style:{width:"100px"}},"Details")])],-1)),e("tbody",null,[(c(!0),y(E,null,A(s.bookings,(n,u)=>{var k,$,C,_,S,F,P,B,M;return c(),y("tr",{key:u},[e("td",null,o(u+1),1),e("td",null,o((k=n==null?void 0:n.event)==null?void 0:k.name),1),e("td",null,o(($=n==null?void 0:n.header)==null?void 0:$.event_pax)+"pax",1),e("td",null,o((C=n==null?void 0:n.header)==null?void 0:C.event_date),1),e("td",null,o((_=n==null?void 0:n.header)==null?void 0:_.event_start_time),1),e("td",null,o((S=n==null?void 0:n.header)==null?void 0:S.event_end_time),1),e("td",null,o(s.toCurrencyFormat((F=n==null?void 0:n.header)==null?void 0:F.add_fee_amount)),1),e("td",null,o(s.toCurrencyFormat(parseFloat((P=n==null?void 0:n.header)==null?void 0:P.total_price)+parseFloat((B=n==null?void 0:n.header)==null?void 0:B.add_fee_amount))),1),e("td",null,o((M=n==null?void 0:n.status)==null?void 0:M.value),1),e("td",null,[e("button",{class:"btn btn-success btn-sm",onClick:N=>s.openPayment(n)},"Payment",8,yt)]),e("td",null,[e("button",{class:"btn btn-primary btn-sm",onClick:N=>s.openBooking(n)},"Details",8,ct)])])}),128))])])])])])]),b(d),b(r,{open:s.modal.booking.open,booking:s.modal.booking.booking,onClosed:t[0]||(t[0]=()=>{s.modal.booking.open=!1}),onRefresh:t[1]||(t[1]=n=>s.fetchMyBooking())},null,8,["open","booking"]),b(l,{open:s.modal.payment.open,booking:s.modal.payment.booking,onClosed:t[2]||(t[2]=()=>{s.modal.payment.open=!1}),onRefresh:t[3]||(t[3]=n=>s.fetchMyBooking())},null,8,["open","booking"])])])}const $t=L(lt,[["render",ht]]);export{$t as default};
